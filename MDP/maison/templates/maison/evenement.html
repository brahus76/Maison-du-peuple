{% extends "base.html" %}
{% load tz %}

{% block contenu %}

{% now "Y-m-d" as today %}
<div class="container mb-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <input
                type="text"
                id="search-event"
                class="form-control"
                placeholder="üîç Rechercher un acteur"
            >
        </div>
    </div>
</div>

<div class="container my-5">
    <div class="row g-4">

        {% for n in Evenement %}

        <div class="col-md-4"data-acteurs="{% for a in n.intervenant.all %}{{ a.nom|lower }} {% endfor %}">
            <div class="card h-100 shadow-sm">

                {# IMAGE #}
                {% if n.image %}
                <div class="position-relative">
                    <img src="{{ n.image.url }}" alt="{{ n.nom_titre }}" class="card-img-top">

                    {# BADGE DATE #}
                    <span class="position-absolute top-0 end-0 m-2 badge bg-warning text-dark">
                        {{ n.date_debut|date:"d M" }}
                    </span>
                </div>
                {% endif %}

                <div class="card-body d-flex flex-column">

                    {# TYPE #}
                    <span class="badge bg-light text-warning mb-2 w-fit">
                        {{ n.type_evenements }}
                    </span>

                    {# TITRE #}
                    <h5 class="card-title fw-bold">
                        {{ n.nom_titre }}
                    </h5>

                    {# CONTENU DYNAMIQUE #}
                    {% if n.genre %}
                        <p><strong>Th√®me :</strong> {{ n.genre }}</p>
                    {% elif n.orga %}
                        <p><strong>Organisation :</strong> {{ n.orga }}</p>
                    {% elif n.cause %}
                        <p><strong>Cause :</strong> {{ n.cause }}</p>
                    {% elif n.secteur %}
                        <p><strong>Secteur :</strong> {{ n.secteur }}</p>
                    {% endif %}

                    {# ARTISTES #}
                    <p class="mb-1"><strong>Artistes :</strong></p>
                    <ul class="small">
                        {% for artiste in n.intervenant.all %}
                            <li>{{ artiste.nom }}</li>
                        {% empty %}
                            <li>Aucun artiste programm√©</li>
                        {% endfor %}
                    </ul>

                    {# DATES #}
                    <p class="mb-1">
                        <strong>D√©but :</strong> {{ n.date_debut|date:"d/m/Y" }}
                    </p>
                    <p>
                        <strong>Fin :</strong> {{ n.date_fin|date:"d/m/Y" }}
                    </p>

                    {# STATUT #}
                    <div class="mt-auto">

                        {% if n.date_debut <= today and n.date_fin >= today %}
                            <span class="badge bg-success mb-2">‚è≥ En cours</span>
                        {% elif n.date_debut > today %}
                            <span class="badge bg-primary mb-2">üìÖ √Ä venir</span>
                        {% endif %}

                        {% if n.est_urgent %}
                            <span class="badge bg-danger mb-2">üî• Se termine bient√¥t</span>
                        {% endif %}

                        <a href="{% url 'acheter_ticket' n.id %}" class="btn btn-outline-warning w-100 mt-2">
                            Prendre un ticket ‚Üí
                        </a>
                    </div>

                </div>
            </div>
        </div>
        {% empty %}
            <p class="text-center">Aucun √©v√©nement disponible.</p>
        {% endfor %}

    </div>
</div>

{% endblock contenu %}
